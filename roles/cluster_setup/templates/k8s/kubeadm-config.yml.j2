{% if kubernetes_version is version('1.26.0','>=')  %}
apiVersion: kubeadm.k8s.io/v1beta3
{% else %}
apiVersion: kubeadm.k8s.io/v1beta2
{% endif %}
kind: ClusterConfiguration
kubernetesVersion: {{ kubernetes_version.split('-')[0] }}
controlPlaneEndpoint: "{{ k8s_control_plane_host }}:{{ k8s_control_plane_port }}"
networking:
  serviceSubnet: {{ k8s_service_subnet }}
  podSubnet: {{ k8s_pod_subnet }}
  dnsDomain: "cluster.local"
apiServer:
  certSANs:
    - "kubernetes"
    - "{{ k8s_control_plane_host }}"
    - "{{ k8s_control_plane_ip }}"
{% if kubernetes_audit_webhook|bool == True  %}
  extraArgs:
    audit-policy-file: /etc/kubernetes/policies/audit-policy.yaml
    audit-webhook-config-file=/etc/kubernetes/policies/webhook-config.yaml
    audit-webhook-initial-backoff=10m
  extraVolumes:
    - name: audit-policy
      hostPath: /etc/kubernetes/policies/
      mountPath: /etc/kubernetes/policies/
      readOnly: true
      pathType: "DirectoryOrCreate"
{% endif %}
